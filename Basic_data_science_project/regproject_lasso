import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.linear_model import LinearRegression,Lasso,LassoCV,Ridge,RidgeCV,ElasticNet,ElasticNetCV
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import mean_absolute_error,mean_squared_error,r2_score
import pickle

df=pd.read_csv(r"C:\Users\jaivenkateg\Desktop\practice\data_sets\Agerian_forest_project_cleaned.csv")
df.drop(['day','month','year','Unnamed: 0'],inplace=True,axis=1)
x=df.drop(['FWI'],axis=1)
y=df[['FWI']]
x_train,x_test,y_train,y_test=train_test_split(x,y,test_size=.30,random_state=42)
scalar=StandardScaler()
sns.heatmap(x_train.corr(),annot=True)
plt.show()
def correlation(dataset,threshold):
    col_corr=set()
    corr_matrix=dataset.corr()
    for i in range(len(dataset.columns)):
        for j in range(i):
            if abs(corr_matrix.iloc[i,j]>threshold):
                col_name=corr_matrix.columns[i]
                col_corr.add(col_name)
    return col_corr
corr_feature=correlation(x_train,0.85)
x_train.drop(corr_feature,axis=1,inplace=True)
x_test.drop(corr_feature,axis=1,inplace=True)
plt.title("X train before scalling")
plt.boxplot(x_train)
x_train=scalar.fit_transform(x_train)
x_test=scalar.fit_transform(x_test)
plt.show()
plt.title("X_train after the Scalling")
plt.boxplot(x_train)
lin=LinearRegression()
lin.fit(x_train,y_train)
y_pred=lin.predict(x_test)
mse=mean_squared_error(y_test,y_pred)
mae=mean_absolute_error(y_test,y_pred)
rmse=np.sqrt(mse)
rscore=r2_score(y_test,y_pred)
print(f'mse{mse},mae{mae},rmse{rmse},r2score{rscore}')
adjscore=1-(1-rscore)*(len(y_test)-1)/(len(y_test)-x_test.shape[1]-1)
print(adjscore)
plt.scatter(y_test,y_pred)
la=Lasso()
la.fit(x_train,y_train)
y_pred_lasso=la.predict(x_test)
mse=mean_squared_error(y_test,y_pred_lasso)
mae=mean_absolute_error(y_test,y_pred_lasso)
rmse=np.sqrt(mse)
rscore=r2_score(y_test,y_pred_lasso)

lacv=LassoCV(cv=5)
lacv.fit(x_train,y_train)
y_pred_lassocv=lacv.predict(x_test)
mse=mean_squared_error(y_test,y_pred_lassocv)
mae=mean_absolute_error(y_test,y_pred_lassocv)
rmse=np.sqrt(mse)
rscore=1.5833177539702514
r2_score(y_test,y_pred_lassocv)

reg=Ridge()
reg.fit(x_train,y_train)
y_pred_Reg=reg.predict(x_test)
mse=mean_squared_error(y_test,y_pred_Reg)
mae=mean_absolute_error(y_test,y_pred_Reg)
rmse=np.sqrt(mse)
rscore=r2_score(y_test,y_pred_Reg)

racv=RidgeCV(cv=5)
racv.fit(x_train,y_train)
y_pred_Reg_cv=racv.predict(x_test)
mse=mean_squared_error(y_test,y_pred_lassocv)
mae=mean_absolute_error(y_test,y_pred_lassocv)
rmse=np.sqrt(mse)
rscore=r2_score(y_test,y_pred_lassocv)

Elastic=ElasticNet()
Elastic.fit(x_train,y_train)
y_pred_elastic=Elastic.predict(x_test)
mse=mean_squared_error(y_test,y_pred_elastic)
mae=mean_absolute_error(y_test,y_pred_elastic)
rmse=np.sqrt(mse)
rscore=r2_score(y_test,y_pred_elastic)

ElasticCV=ElasticNetCV(cv=5)
ElasticCV.fit(x_train,y_train)
y_pred_elasticcv=ElasticCV.predict(x_test)
mse=mean_squared_error(y_test,y_pred_elasticcv)
mae=mean_absolute_error(y_test,y_pred_elasticcv)
rmse=np.sqrt(mse)
rscore=r2_score(y_test,y_pred_elasticcv)

pickle.dump(Elastic,open("Elastic.pkl",'wb'))
pickle.dump(reg,open("Ridge.pkl",'wb'))
pickle.dump(scalar,open("Scalar.pkl",'wb'))